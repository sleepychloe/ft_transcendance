version: '3'

services:
  #backend framework
  django:
    build:
      context: ../srcs/backend
      dockerfile: ../../docker/django/dockerfile
    container_name: django
    restart: always
    volumes:
      - "./.data/django"
    expose:
      - "8000"
    networks:
      - ft_network
    env_file:
      .env
    depends_on:
      - postgresql
    tty: true
  
  #Database server
  postgresql:
    build: ./postgresql
    container_name: postgresql
    volumes:
      - "./.data/postgre"
    expose:
      - "5432"
    ports:
      - "5432:5432"
    networks:
      - ft_network
    env_file:
      .env
    tty: true
  
  #webserver
  nginx:
    build: ./nginx
    restart: always
    container_name: nginx
    volumes:
      - "./.data/nginx"
    ports:
      - "443:443"
    networks:
      - ft_network
    tty: true
    depends_on:
      - django
  
  #ELK containers
  # elasticsearch:
  #   build: ./ELK/elasticsearch
  #   tty: true

  # logstash:
  #   build: ./ELK/logstash
  #   tty: true

  # kibana:
  #   build: ./ELK/kibana
  #   tty: true


volumes:
  postegre-volume:
    name: postgre-volume
    driver: local
    driver_opts:
      type: none
      device: ./.data/postgre
      o: bind

networks:
  ft_network:
    driver: bridge